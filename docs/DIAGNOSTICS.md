# Gregorio LSP Diagnostic Codes

This document lists all diagnostic codes generated by Gregorio LSP, organized by category and severity level.

## Severity Levels

- **Error** (1): Critical issues that prevent correct compilation or violate GABC syntax
- **Warning** (2): Issues that may cause unexpected behavior or violate best practices
- **Information** (3): Suggestions for improvement or style recommendations
- **Hint** (4): Minor suggestions or optimization opportunities

---

## Header Validation

### `missing-required-header` (Warning)
**Description**: A required header is missing from the GABC file.

**Required headers**: `name`, `office-part`, `mode`

**Example**:
```gabc
% Missing 'name' header
office-part: Antiphon;
mode: I;
%%
Text(f)here(g). (::)
```

**Fix**: Add the missing header
```gabc
name: Example Antiphon;
office-part: Antiphon;
mode: I;
%%
Text(f)here(g). (::)
```

---

### `invalid-mode` (Error)
**Description**: The `mode` header contains an invalid Gregorian mode value.

**Valid values**: `1-8`, `I-VIII`, `P` (Peregrinus)

**Example**:
```gabc
name: Example;
mode: 9;  % Invalid: must be 1-8 or I-VIII
%%
```

**Fix**: Use a valid mode
```gabc
name: Example;
mode: VIII;  % or mode: 8;
%%
```

---

### `invalid-header-value` (Warning)
**Description**: A header contains an unexpected or invalid value.

**Example**:
```gabc
name: Example;
initial-style: 5;  % Invalid: must be 0, 1, or 2
%%
```

---

## NABC-lines Validation

### `nabc-lines-alternation-error` (Error)
**Description**: Incorrect alternation between GABC and NABC lines when `nabc-lines: 1` is set.

**Pattern**: With `nabc-lines: 1`, lines must alternate: GABC, NABC, GABC, NABC...

**Example**:
```gabc
name: Example;
nabc-lines: 1;
%%
First(f)GABC(g)line. (::)
Second(g)GABC(h)line. (::)  % Error: should be NABC
```

**Fix**: Follow the alternation pattern
```gabc
name: Example;
nabc-lines: 1;
%%
First(f)GABC(g)line. (::)
1f n2g Second NABC line  % NABC notation
```

---

### `invalid-nabc-lines-value` (Error)
**Description**: The `nabc-lines` header has an invalid value.

**Valid values**: `0` (disabled) or `1` (enabled)

**Example**:
```gabc
nabc-lines: 2;  % Invalid
%%
```

---

## Musical Notation Validation

### `invalid-pitch` (Error)
**Description**: An invalid pitch letter is used in GABC notation.

**Valid pitches**: `a-m` (13 notes)

**Example**:
```gabc
%%
Text(n)here. (::)  % Error: 'n' is not a valid pitch
```

---

### `invalid-neume-modifier` (Error)
**Description**: An invalid modifier is applied to a GABC neume.

**Valid modifiers**: `~` (liquescent), `v` (cavum), `<` (punctum inclinatum ascendens), `>` (punctum inclinatum descendens), `o` (oriscus), `r` (virga reversa), `s` (stropha), `w/W` (quilisma)

**Example**:
```gabc
%%
Text(fx)here. (::)  % Error: 'x' is not a valid modifier
```

---

## Quilisma Validation

### `quilisma-glyph-break` (Information)
**Description**: Suggests adding a glyph break (`!`) before the quilisma note for better rendering.

**Rationale**: The glyph break helps ensure proper spacing and visual distinction of the quilisma.

**Example**:
```gabc
%%
Text(gwh)here. (::)
```

**Suggestion**: Add glyph break
```gabc
%%
Text(g!wh)here. (::)
```

**Pattern detected**: Any pitch (`a-m`) followed by `w` or `W`

---

### `quilisma-ascending-motion` (Warning)
**Description**: Quilisma should be followed by a note with higher pitch according to Gregorian chant conventions.

**Rationale**: The quilisma is a special neume used in ascending melodic contexts. When followed by a lower or equal pitch, it may indicate a notation error.

**Example**:
```gabc
%%
Text(gwf)here. (::)  % Warning: f â‰¤ g (not ascending)
```

**Fix**: Ensure quilisma ascends
```gabc
%%
Text(gwh)here. (::)  % OK: h > g (ascending)
```

**Pitch comparison**: Letters are compared by ASCII code where `m > l > k > j > i > h > g > f > e > d > c > b > a`

---

### `quilisma-no-following-note` (Warning)
**Description**: Quilisma appears at the end of a notation segment without a following note.

**Example**:
```gabc
%%
Text(gw). (::)  % Warning: quilisma needs following note
```

**Fix**: Add following note
```gabc
%%
Text(gwh). (::)  % OK: quilisma followed by h
```

---

## NABC Notation Validation

### `invalid-nabc-glyph` (Error)
**Description**: Invalid NABC glyph descriptor detected.

**Valid NABC neume codes** (33 total):
- **St. Gall (31)**: `vi`, `pu`, `ta`, `gr`, `cl`, `pe`, `po`, `to`, `ci`, `sc`, `pf`, `sf`, `tr`, `st`, `ds`, `ts`, `tg`, `bv`, `tv`, `pr`, `pi`, `vs`, `or`, `sa`, `pq`, `ql`, `qi`, `pt`, `ni`
- **Laon (2)**: `un`, `oc`

**Valid modifiers**: `S`, `G`, `M`, `\-`, `>`, `~`

**Example**:
```gabc
nabc-lines: 1;
%%
GABC(f)line. (::)
xy3g invalid NABC  % Error: 'xy' is not a valid neume code
```

---

### `invalid-nabc-pitch` (Error)
**Description**: Invalid pitch descriptor in NABC notation.

**Valid NABC pitches**: `1a-4m`, `n0-nf`

**Example**:
```gabc
nabc-lines: 1;
%%
GABC(f)line. (::)
vi5n invalid  % Error: '5n' is invalid (valid: 1a-4m or n0-nf)
```

---

## Syllable Structure Validation

### `syllable-no-text` (Information)
**Description**: A syllable has musical notation but no text content.

**Example**:
```gabc
%%
Text(f)here(g)(h). (::)  % Information: (h) has no text
```

**Note**: This is informational as it may be intentional (e.g., melismas).

---

### `syllable-no-music` (Warning)
**Description**: A syllable has text but no musical notation.

**Example**:
```gabc
%%
Text(f)here()more. (::)  % Warning: 'more' has no notation
```

---

## Configuration

Diagnostic behavior can be configured via LSP settings:

```json
{
  "gregorioLsp": {
    "maxNumberOfProblems": 1000,
    "enableSemanticValidation": true,
    "enableNabcLinesValidation": true,
    "strictAlternationChecking": true,
    "enableQuilismaValidation": true
  }
}
```

### Settings:
- `maxNumberOfProblems`: Maximum diagnostics to report per file
- `enableSemanticValidation`: Enable/disable all semantic checks
- `enableNabcLinesValidation`: Enable/disable NABC alternation checks
- `strictAlternationChecking`: Treat alternation issues as errors (true) or warnings (false)
- `enableQuilismaValidation`: Enable/disable quilisma-specific checks

---

## See Also

- [README.md](../README.md) - General project documentation
- [NABC_COMPREHENSIVE_ANALYSIS.md](NABC_COMPREHENSIVE_ANALYSIS.md) - NABC notation specification
- [LSP Specification](https://microsoft.github.io/language-server-protocol/) - Language Server Protocol documentation
